<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>

<body>
  <form id="search" action="/submit_form" method="#">
    <label for="searchterm">Search Gifs for:</label><br>
    <textarea id="searchterm" name="searchterm" rows="1" cols="20"></textarea><br><br>
    <input type="submit" value="Submit Message">
  </form>

  <button class="btn-refresh btn">Refresh</button>
  <img src="#">
  <script>
    const img = document.querySelector('img');

    // define getGif which takes a search term as an argument
    const getGif = function (search = 'cat') {
      fetch('https://api.giphy.com/v1/gifs/translate?api_key=fylhgAhBfPGbtB0VvnMzA4XTg0VCqvD8&s=' + search, { mode: 'cors' })
        .then(
          response => {

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            return response.json();
          },
          error => console.log('Error!')
        )
        .then(
          response => {
            // Check if the API returned an error or no data
            if (response.meta && response.meta.status !== 200) {
              throw new Error(`API error: ${response.meta.msg}`);
            }

            // Check if data exists and has the expected structure
            if (!response.data || !response.data.images || !response.data.images.original) {
              throw new Error(`No GIF found for search term: "${search}"`);
            }
            img.src = response.data.images.original.url
            img.style.display = 'inline-block';
          },
          error => console.log('Error!!')
        )
        .catch(
          error => {
            console.error('Error fetching GIF:', error.message);
            alert(`Could not load GIF for "${search}"`);
            img.style.display = 'none';
          }
        );
    }

    // initialize with search for cat
    const btn = document.querySelector('.btn-refresh');
    getGif()
    btn.addEventListener('click', getGif);

    // store the current listener
    let curListener = getGif;

    // submit form will search for gif
    const searchForm = document.getElementById('search');
    const searchFn = function (event) {
      event.preventDefault();
      const searchTerm = document.getElementById('searchterm');
      getGif(searchTerm.value);

      // replace refresh button listener with search listener
      btn.removeEventListener('click', curListener);
      curListener = searchFn;
      btn.addEventListener('click', curListener);
    }

    searchForm.addEventListener('submit', searchFn)
  </script>
</body>

</html>